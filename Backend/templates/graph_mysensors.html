<!-- Agrega este contenido en tu plantilla HTML (por ejemplo, graph_mysensors.html) -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Sensors Graph</title>
    <!-- Agrega el enlace al archivo Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <h1>My Sensors Graph</h1>

    <form id="graphForm">
        <label for="y-axis-field">Select Y-axis:</label>
        <select name="y-axis-field">
            <option value="pm10">PM10</option>
            <option value="pm25">PM2.5</option>
            <option value="um100">UM100</option>
        </select>
        <button type="submit">Generate Graph</button>
    </form>

    <canvas id="sensorChart" width="800" height="400"></canvas>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Manejar el formulario para obtener el eje Y seleccionado por el usuario
            var form = document.getElementById('graphForm');
            form.addEventListener('submit', function (event) {
                event.preventDefault();

                // Obtener el valor seleccionado del eje Y
                var y_axis_field = form.querySelector('select[name="y-axis-field"]').value;

                // Enviar la solicitud POST al backend con el eje Y seleccionado
                fetch('/graph_mysensors', {
                    method: 'POST',
                    body: new URLSearchParams({
                        'y-axis-field': y_axis_field
                    }),
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    }
                })
                    .then(response => response.json())
                    .then(data => {
                        // Procesar los datos y crear la gráfica
                        generateChart(data);
                    })
                    .catch(error => console.error('Error:', error));
            });
        });

        // Función para generar la gráfica con Chart.js
        function generateChart(data) {
            var labels = data.map(entry => entry.lastUpdated);
            var datasets = [];

            // Crear un conjunto de datos para cada parámetro seleccionado en el eje Y
            ['pm10', 'pm25', 'um100'].forEach(param => {
                var values = data.map(entry => entry[param]);

                datasets.push({
                    label: param,
                    data: values,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                });
            });

            // Crear la gráfica
            var ctx = document.getElementById('sensorChart').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
    </script>
</body>

</html>

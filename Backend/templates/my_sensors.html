<!-- my_sensors.html -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Sensors</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.3/css/bulma.min.css">
</head>

<body>
    <section class="hero is-primary">
        <div class="hero-body">
            <div class="container">
                <h1 class="title">
                    My Sensors
                </h1>
                <h2 class="subtitle">
                    List of Selected Sensors
                </h2>
            </div>
        </div>
    </section>

    <div class="section">
        <div class="container">
            <ul id="mySensorsList">
                <!-- Datos de sensores se cargarán dinámicamente aquí -->
            </ul>
        </div>
    </div>

    <script>
        // Función para actualizar la lista de sensores
        function updateMySensorsList(data) {
            var mySensorsList = document.getElementById('mySensorsList');
            mySensorsList.innerHTML = '';

            data.forEach(sensor => {
                var listItem = document.createElement('li');
                listItem.innerHTML = `
                    <strong>ID:</strong> ${sensor._id}<br>
                    <strong>Location:</strong> ${sensor.location}<br>
                    <strong>Country:</strong> ${sensor.country}<br>
                    <button class="button is-danger" onclick="removeSensor('${sensor._id}')">Remove</button>
                    <hr>
                `;
                mySensorsList.appendChild(listItem);
            });
        }

        // Función para eliminar un sensor
        function removeSensor(sensorId) {
            // Enviar solicitud para eliminar el sensor
            fetch('/remove_sensor', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ sensorId }),
            })
            .then(response => response.json())
            .then(data => {
                // Manejar la respuesta según sea necesario
                console.log(data);
                // Actualizar la lista después de la eliminación
                fetch('/my_sensors')
                    .then(response => response.json())
                    .then(data => {
                        updateMySensorsList(data);
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        }

        // Obtener la lista de sensores al cargar la página
        fetch('/my_sensors')
            .then(response => response.json())
            .then(data => {
                updateMySensorsList(data);
            })
            .catch((error) => {
                console.error('Error:', error);
            });
    </script>
</body>

</html>


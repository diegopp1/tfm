<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Sensors</title>
    <style>
        /* ... (tu estilo actual) */
    </style>
</head>

<body>
    <header>
        <a href="/" class="home-link">
            <h1><strong>AIR QUALITY APP</strong></h1>
        </a>
    </header>

    <nav>
        <a href="/locations">Generate Data</a>
        <a href="/graph">Graph</a>
        <a href="/worldmap">World Map</a>
        <a href="/data">Stored Data</a>
        <a href="/my_sensors">My Sensors</a>
    </nav>

    <section class="hero is-primary">
        <div class="hero-body">
            <div class="container">
                <h1 class="title">
                    My Sensors
                </h1>
                <h2 class="subtitle">
                    List of Selected Sensors
                </h2>
            </div>
        </div>
    </section>

    <div class="section">
        <div class="container">
            <ul id="mySensorsList">
                <!-- Datos de sensores se cargarán dinámicamente aquí -->
            </ul>
        </div>
    </div>

    <script>
        function updateMySensorsList(data) {
            var mySensorsList = document.getElementById('mySensorsList');
            mySensorsList.innerHTML = '';

            data.forEach(sensor => {
                var listItem = document.createElement('li');
                listItem.classList.add('sensor-item');

                listItem.innerHTML = `
                    <div class="sensor-details">
                        <strong>ID:</strong> ${sensor._id}<br>
                        <strong>Location:</strong> ${sensor.location}<br>
                        <strong>Country:</strong> ${sensor.country}<br>
                    </div>
                    <div class="remove-button" onclick="removeSensor('${sensor._id}')">
                        Remove
                    </div>
                    <div>
                        <button class="start-button" onclick="startKafkaProducer('${sensor._id}')">
                            Start Streaming
                        </button>
                    </div>
                `;
                mySensorsList.appendChild(listItem);
            });
        }

        function removeSensor(sensorId) {
            fetch('/remove_sensor', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ sensorId }),
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                window.location.reload();
            })
            .catch(error => console.error('Error:', error));
        }

        function startKafkaProducer(sensorId) {
            fetch('/start_mysensors_producer', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ sensorId }),
            })
            .then(response => response.json())
            .then(data => console.log(data))
            .catch(error => console.error('Error:', error));
        }

        updateMySensorsList(JSON.parse('{{ sensors_list | tojson | safe }}'));
    </script>
</body>

</html>
